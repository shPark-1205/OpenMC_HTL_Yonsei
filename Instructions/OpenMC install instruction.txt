2025. 07. 04. (Fri)
Seong-Hyeok Park
Heat Transfer Lab. @ Yonsei University

This guide outlines the process for setting up a virtual Linux environment on Windows using Docker and installing OpenMC for Python API development.


Option 1: Manually Building and Configuring the OpenMC Environment

1. OpenMC Installation
	○ Instead of using the GitHub Dockerfile, this method pulls a pre-built image from Docker Hub:
	○ Access Docker Hub: Go to https://hub.docker.com/r/openmc/openmc/tags.
	○ Select a Tag: Copy the tag that matches your desired OpenMC branch and includes DAGMC (for CAD support).
	○ The recommended tag is one that includes both DAGMC and LibMesh (in CMD):
	    - docker pull openmc/openmc:develop-dagmc-libmesh
	○ Verify Installation: In your CMD, run docker images. You should see the installed image (Name: openmc/openmc, Tag: branch-dagmc-libmesh).
	○ Run Container: Start the container and enter its shell environment:
	    - docker run -it --name [your_container_name] [image_name_or_ID] bash
	    Example: docker run -it --name openmc_container_v1.0 a19b184aa070 bash
	    Success is indicated by the prompt changing to root@~~~:/#.
	○ Verify OpenMC: Inside the container, confirm OpenMC and DAGMC support:
	    - openmc --v (Check that DAGMC support : yes is diaplayed.)
	    - pip list (Lists currently installed Python packages.)

2. Nuclear Cross-Section Data Setup
	○ OpenMC requires cross-section data for analysis.
	○ Download Data: Download the necessary nuclear cross-section library (e.g., ENDF) from the OpenMC website.
	    - https://openmc.org/official-data-libraries/
	○ Extract: Unzip the file (e.g., to create the folder endfb-vii.1-hdf5).
	○ Prepare Container Path: Inside the container (root@~~~:/# prompt):
	    - mkdir /app/data (Creates a directory for the data.)
	○ Exit Shell: Exit the container's shell without stopping the container:
	    - Press Ctrl + P + Q
	○ Copy Data: Copy the local data folder into the running container:
	    - docker cp "[path_to_endfb-vii.1-hdf5]" [container_name]:/app/data/
	    Example: docker cp "C:\Users\MyName\OpenMC\endfb-vii.1-hdf5" openmc_container_v1.0:/app/data/
	○ Verify Copy:
	    - docker exec [container_name] bash
	    - ls /app/data (Check that the copied file is present.)

3. Python Package and Library Installation
	○ You may need additional Python packages and Linux libraries for plotting, etc.
	○ Method 1: Manual Package Install: Enter the container shell
	    - docker exec -it [container_name] bash
	    - pip install [package_name].
	○ Method 2: Install from requirements.txt:
	    - Obtain the requirements.txt file from the author and save it locally.
	    - docker cp "[path_to_requirements.txt]" [container_name]:/app/
	    - docker exec [container_name] pip install -r /app/requirements.txt
	○ Install Required Libraries: Install libraries needed for packages like Matplotlib/VTK.
	    - apt-get update && \
	    apt-get install -y --fix-missing \
        libmpich-dev libhdf5-serial-dev libhdf5-mpich-dev \
        libpng-dev libglu1-mesa libxcursor1 libxrender1 \
        libxi6 libxrandr2 libgl1 libglu1 libglx-mesa0 \
        libxinerama1 libexpat1 libeigen3-dev libtbb-dev \
        libglfw3-dev libxft2 python3-tk

4. Final Image Creation
	○ Create a new, persistent Docker image containing all your configurations (data, packages, and libraries).
	○ Exit Shell: Make sure you are outside the container shell (back in Windows CMD).
	○ Commit Changes:
	    - docker commit [container_ID_or_name] [New_image_name]
	    Example: docker commit openmc_container_v1.0 openmc_psh_v1.1
	○ Verify: Run docker images to confirm the new image is listed.


Option 2: Building from Author's Dockerfile

	○ If you have the author's Dockerfile and support files:
	○ Obtain Files: Request the Dockerfile and supporting files from the author and copy them to a folder on your machine.
	○ Build Image:
	    - cd [your_folder_path]
	    - docker build -t openmc_YOURNAME_v#.# . (Note the dot at the end!)
	    Example: docker build -t openmc_psh_v1.1 .
	    - Wait for the image build to complete.
	○ Verify: Run docker images to confirm the new image is listed.
	○ Proceed to Python Setup (Section 5).


Option 3: Loading Author's Pre-saved Image

	○ Obtain Image: Get the author's saved Docker image file.
	○ Load Image: Load the image into your Docker Desktop.
	○ Proceed to Python Setup (Section 5).


5. Python Environment Setup (PyCharm)
	○ This section details setup for PyCharm. Adjust for other IDEs as needed.
	○ Create Project: Create a new project in PyCharm.
	○ Access Settings: Go to File → Settings (or Ctrl + Alt + S).
	○ Add Docker Interpreter:
	    - Navigate to Project: [Your Project Name] → Python Interpreter.
	    - Click the gear icon → Add Interpreter → On Docker.
	    - Select Image → Use existing or Pull.
	    - Image Tag: Enter the name of the final image you created (e.g., openmc_psh_v1.1).
	    - Click Next → Create.
	○ Verify: Check the interpreter package list to ensure all necessary Python packages are installed.

6. Graphics Environment Setup (VcXsrv)
    ○ To view graphics (like plots and geometry) from the Docker container on your Windows machine, you need an X server.
    ○ Install VcXsrv: Download and install VcXsrv from https://vcxsrv.com/.
    ○ Run XLaunch:
        - Execute XLaunch.
        - Follow the prompts.
        - Crucially, on the final configuration screen, check the box for: Disable access control.
        - Follow the prompts.
    ○ Set Environment Variable in PyCharm:
        - In PyCharm, click the three vertical dots next to your project configuration in the upper right → Edit Configurations.
        - In the Environment Variables section, click the folder icon to add a new variable.
        - Variable: DISPLAY
        - Value: host.docker.internal:0
